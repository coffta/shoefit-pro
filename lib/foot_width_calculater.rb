class FootWidthCalculator
  def calculate_foot_width
    gender = params[:gender].to_s
    # パラメータ名の組み合わせに応じてfoot_lengthとfoot_widthを取得
    if params[:foot_length_right]
      foot_length = params[:foot_length_right].to_i
      foot_width = params[:foot_width_load_right].to_i
    elsif params[:foot_length_left]
      foot_length = params[:foot_length_left].to_i
      foot_width = params[:foot_width_load_left].to_i
    elsif params[:foot_length_right_nonload]
      foot_length = params[:foot_length_right_nonload].to_i
      foot_width = params[:foot_width_nonload_right].to_i
    elsif params[:foot_length_left_nonload]
      foot_length = params[:foot_length_left_nonload].to_i
      foot_width = params[:foot_width_nonload_left].to_i
    else
    # foot_lengthかfoot_widthのどちらかが足りない場合の処理
      render :calculate_width # 同じアクションを再度呼び出し、ビューを表示
      return
    end
    
    gender_chart = case gender
    when "male"
      width_chart_male
    when "female"
      width_chart_female
    else
      width_chart_kids
    end

    selected_range = gender_chart.find { |size, ranges| ranges.any? { |range| range[0].include?(foot_length) && range[1].include?(foot_width) } }

    selected_range ? selected_range[0] : nil

  end

  private

  def width_chart_female
    {
      "A" => [[193..197, 75..76], [198..202, 77..78], [203..207, 78..79], [208..212, 79..80], [213..217, 80..81], [218..222, 82..83], [223..227, 83..84], [228..232, 84..85], [233..237, 85..86], [238..242, 87..88], [243..247, 88..89], [248..252, 89..90], [253..257, 90..91], [258..262, 92..93], [263..267, 93..94], [268..272, 94..95]],
      "B" => [[193..197, 77..78], [198..202, 79..80], [203..207, 80..81], [208..212, 81..82], [213..217, 82..83], [218..222, 84..85], [223..227, 85..86], [228..232, 86..87], [233..237, 87..89], [238..242, 89..90], [243..247, 90..91], [248..252, 91..92], [253..257, 92..94], [258..262, 94..95], [263..267, 95..96], [268..272, 96..97]],
      "C" => [[193..197, 79..81], [198..202, 81..82], [203..207, 82..83], [208..212, 83..84], [213..217, 84..86], [218..222, 86..87], [223..227, 87..88], [228..232, 88..89], [233..237, 90..91], [238..242, 91..92], [243..247, 92..93], [248..252, 93..94], [253..257, 95..96], [258..262, 96..97], [263..267, 97..98], [268..272, 98..99]],
      "D" => [[193..197, 82..83], [198..202, 83..84], [203..207, 84..85], [208..212, 85..86], [213..217, 87..88], [218..222, 88..89], [223..227, 89..90], [228..232, 90..91], [233..237, 92..93], [238..242, 93..94], [243..247, 94..95], [248..252, 95..96], [253..257, 97..98], [258..262, 98..99], [263..267, 99..100], [268..272, 100..102]],
      "E" => [[193..197, 84..85], [198..202, 85..86], [203..207, 86..87], [208..212, 87..88], [213..217, 89..90], [218..222, 90..91], [223..227, 91..92], [228..232, 92..94], [233..237, 94..95], [238..242, 95..96], [243..247, 96..97], [248..252, 97..99], [253..257, 99..100], [258..262, 100..101], [263..267, 101..102], [268..272, 103..104]],
      "2E" => [[193..197, 86..87], [198..202, 87..88], [203..207, 88..89], [208..212, 89..91], [213..217, 91..92], [218..222, 92..93], [223..227, 93..94], [228..232, 95..96], [233..237, 96..97], [238..242, 97..98], [243..247, 98..99], [248..252, 100..101], [253..257, 101..102], [258..262, 102..103], [263..267, 103..104], [268..272, 105..106]],
      "3E" => [[193..197, 88..89], [198..202, 89..90], [203..207, 90..91], [208..212, 92..93], [213..217, 93..94], [218..222, 94..95], [223..227, 95..96], [228..232, 97..98], [233..237, 98..99], [238..242, 99..100], [243..247, 100..101], [248..252, 102..103], [253..257, 103..104], [258..262, 104..105], [263..267, 105..107], [268..272, 107..108]],
      "4E" => [[193..197, 90..91], [198..202, 91..92], [203..207, 92..93], [208..212, 94..95], [213..217, 95..96], [218..222, 96..97], [223..227, 97..99], [228..232, 99..100], [233..237, 100..101], [238..242, 101..102], [243..247, 102..104], [248..252, 104..105], [253..257, 105..106], [258..262, 106..107], [263..267, 108..109], [268..272, 109..110]],
      "F" => [[193..197, 92..93], [198..202, 93..94], [203..207, 94..96], [208..212, 96..97], [213..217, 97..98], [218..222, 98..99], [223..227, 100..101], [228..232, 101..102], [233..237, 102..103], [238..242, 103..104], [243..247, 105..106], [248..252, 106..107], [253..257, 107..108], [258..262, 108..109], [263..267, 110..111], [268..272, 111..112]]
    }
  end

  def width_chart_male
    {
      "A" => [[198..202, 78..79], [203..207, 80..81], [208..212, 81..82], [213..217, 82..83], [218..222, 83..84], [223..227, 84..85], [228..232, 86..87], [233..237, 87..88], [238..242, 88..89], [243..247, 89..90], [248..252, 91..92], [253..257, 92..93], [258..262, 93..94], [263..267, 94..95], [268..272, 95..96], [273..277, 97..98], [278..282, 98..99], [283..287, 99..100], [288..292, 100..101], [293..297, 102..103], [298..302, 103..104], [303..307, 104..105]],
      "B" => [[198..202, 80..81], [203..207, 82..83], [208..212, 83..84], [213..217, 84..85], [218..222, 85..86], [223..227, 86..87], [228..232, 88..89], [233..237, 89..90], [238..242, 90..91], [243..247, 91..92], [248..252, 93..94], [253..257, 94..95], [258..262, 95..96], [263..267, 96..97], [268..272, 97..99], [273..277, 99..100], [278..282, 100..101], [283..287, 101..102], [288..292, 102..103], [293..297, 104..105], [298..302, 105..106], [303..307, 106..107]],
      "C" => [[198..202, 82..83], [203..207, 84..85], [208..212, 85..86], [213..217, 86..87], [218..222, 87..88], [223..227, 88..89], [228..232, 90..91], [233..237, 91..92], [238..242, 92..93], [243..247, 93..94], [248..252, 95..96], [253..257, 96..97], [258..262, 97..98], [263..267, 98..99], [268..272, 100..101], [273..277, 101..102], [278..282, 102..103], [283..287, 103..104], [288..292, 104..105], [293..297, 106..107], [298..302, 107..108], [303..307, 108..109]],
      "D" => [[198..202, 84..85], [203..207, 86..87], [208..212, 87..88], [213..217, 88..89], [218..222, 89..90], [223..227, 90..92], [228..232, 92..93], [233..237, 93..94], [238..242, 94..95], [243..247, 95..96], [248..252, 97..98], [253..257, 98..99], [258..262, 99..100], [263..267, 100..101], [268..272, 102..103], [273..277, 103..104], [278..282, 104..105], [283..287, 105..106], [288..292, 106..107], [293..297, 108..109], [298..302, 109..110], [303..307, 110..111]],
      "E" => [[198..202, 86..87], [203..207, 88..89], [208..212, 89..90], [213..217, 90..91], [218..222, 91..92], [223..227, 93..94], [228..232, 94..95], [233..237, 95..96], [238..242, 96..97], [243..247, 97..98], [248..252, 99..100], [253..257, 100..101], [258..262, 101..102], [263..267, 102..103], [268..272, 104..105], [273..277, 105..106], [278..282, 106..107], [283..287, 107..108], [288..292, 108..110], [293..297, 110..111], [298..302, 111..112], [303..307, 112..113]],
      "2E" => [[198..202, 88..89], [203..207, 90..91], [208..212, 91..92], [213..217, 92..93], [218..222, 93..94], [223..227, 95..96], [228..232, 96..97], [233..237, 97..98], [238..242, 98..99], [243..247, 99..100], [248..252, 101..102], [253..257, 102..103], [258..262, 103..104], [263..267, 104..105], [268..272, 106..107], [273..277, 107..108], [278..282, 108..109], [283..287, 109..110], [288..292, 111..112], [293..297, 112..113], [298..302, 113..114], [303..307, 114..115]],
      "3E" => [[198..202, 90..91], [203..207, 92..93], [208..212, 93..94], [213..217, 94..95], [218..222, 95..96], [223..227, 97..98], [228..232, 98..99], [233..237, 99..100], [238..242, 100..101], [243..247, 101..103], [248..252, 103..104], [253..257, 104..105], [258..262, 105..106], [263..267, 106..107], [268..272, 108..109], [273..277, 109..110], [278..282, 110..111], [283..287, 111..112], [288..292, 113..114], [293..297, 114..115], [298..302, 115..116], [303..307, 116..117]],
      "4E" => [[198..202, 92..93], [203..207, 94..95], [208..212, 95..96], [213..217, 96..97], [218..222, 97..98], [223..227, 99..100], [228..232, 100..101], [233..237, 101..102], [238..242, 102..103], [243..247, 104..105], [248..252, 105..106], [253..257, 106..107], [258..262, 107..108], [263..267, 108..109], [268..272, 110..111], [273..277, 111..112], [278..282, 112..113], [283..287, 113..114], [288..292, 115..116], [293..297, 116..117], [298..302, 117..118], [303..307, 118..119]],
      "F" => [[198..202, 94..96], [203..207, 96..97], [208..212, 97..98], [213..217, 98..99], [218..222, 99..100], [223..227, 101..102], [228..232, 102..103], [233..237, 103..104], [238..242, 104..105], [243..247, 106..107], [248..252, 107..108], [253..257, 108..109], [258..262, 109..110], [263..267, 110..111], [268..272, 112..113], [273..277, 113..114], [278..282, 114..115], [283..287, 115..116], [288..292, 117..118], [293..297, 118..119], [298..302, 119..120], [303..307, 120..121]],
      "G" => [[198..202, 97..98], [203..207, 98..99], [208..212, 99..100], [213..217, 100..101], [218..222, 101..102], [223..227, 103..104], [228..232, 104..105], [233..237, 105..106], [238..242, 106..107], [243..247, 108..109], [248..252, 109..110], [253..257, 110..111], [258..262, 111..112], [263..267, 112..114], [268..272, 114..115], [273..277, 115..116], [278..282, 116..117], [283..287, 117..118], [288..292, 119..120], [293..297, 120..121], [298..302, 121..122], [303..307, 122..123]]
    }
  end

  def width_chart_kids
    {
      "A" => [[103..107, 37..38], [108..112, 39..40], [113..117, 40..41], [118..122, 42..43], [123..127, 44..45], [128..132, 45..46], [133..137, 47..48], [138..142, 49..50], [143..147, 51..52], [148..152, 53..54], [153..157, 54..55], [158..162, 56..57], [163..167, 57..58], [168..172, 59..60], [173..177, 61..62], [178..182, 62..63], [183..187, 64..65], [188..192, 66..67], [193..197, 67..68], [198..202, 69..70], [203..207, 71..72], [208..212, 73..74], [213..217, 74..75], [218..222, 76..77], [223..227, 78..79], [228..232, 79..80], [233..237, 81..82], [238..242, 83..84], [243..247, 84..85], [248..252, 86..87], [253..257, 88..89], [258..262, 89..90]],
      "B" => [[103..107, 39..40], [108..112, 41..42], [113..117, 42..43], [118..122, 44..45], [123..127, 46..47], [128..132, 47..49], [133..137, 49..50], [138..142, 51..52], [143..147, 53..54], [148..152, 54..55], [153..157, 56..57], [158..162, 58..59], [163..167, 59..60], [168..172, 61..62], [173..177, 63..64], [178..182, 64..65], [183..187, 66..67], [188..192, 68..69], [193..197, 69..71], [198..202, 71..72], [203..207, 73..74], [208..212, 75..76], [213..217, 76..77], [218..222, 78..79], [223..227, 80..81], [228..232, 81..82], [233..237, 83..84], [238..242, 85..86], [243..247, 86..87], [248..252, 88..89], [253..257, 90..91], [258..262, 91..93]],
      "C" => [[103..107, 41..42], [108..112, 43..44], [113..117, 44..46], [118..122, 46..47], [123..127, 48..49], [128..132, 50..51], [133..137, 51..52], [138..142, 53..54], [143..147, 55..56], [148..152, 56..57], [153..157, 58..59], [158..162, 60..61], [163..167, 61..64], [168..172, 63..64], [173..177, 65..66], [178..182, 66..68], [183..187, 68..69], [188..192, 70..71], [193..197, 72..73], [198..202, 73..74], [203..207, 75..76], [208..212, 77..78], [213..217, 78..79], [218..222, 80..81], [223..227, 82..83], [228..232, 83..85], [233..237, 85..86], [238..242, 87..88], [243..247, 88..90], [248..252, 90..91], [253..257, 92..93], [258..262, 94..95]],
      "D" => [[103..107, 43..44], [108..112, 45..46], [113..117, 47..48], [118..122, 48..49], [123..127, 50..51], [128..132, 52..53], [133..137, 53..54], [138..142, 55..56], [143..147, 57..58], [148..152, 58..60], [153..157, 60..61], [158..162, 62..63], [163..167, 64..65], [168..172, 65..66], [173..177, 67..68], [178..182, 69..70], [183..187, 70..71], [188..192, 72..73], [193..197, 74..75], [198..202, 75..76], [203..207, 77..78], [208..212, 79..80], [213..217, 80..82], [218..222, 82..83], [223..227, 84..85], [228..232, 86..87], [233..237, 87..88], [238..242, 89..90], [243..247, 91..92], [248..252, 92..93], [253..257, 94..95], [258..262, 96..97]],
      "E" => [[103..107, 45..46], [108..112, 47..48], [113..117, 49..50], [118..122, 50..51], [123..127, 52..53], [128..132, 54..55], [133..137, 55..57], [138..142, 57..58], [143..147, 59..60], [148..152, 61..62], [153..157, 62..63], [158..162, 64..65], [163..167, 66..67], [168..172, 67..68], [173..177, 69..70], [178..182, 71..72], [183..187, 72..73], [188..192, 74..75], [193..197, 76..77], [198..202, 77..79], [203..207, 79..80], [208..212, 81..82], [213..217, 83..84], [218..222, 84..85], [223..227, 86..87], [228..232, 88..89], [233..237, 89..90], [238..242, 91..92], [243..247, 93..94], [248..252, 94..95], [253..257, 96..97], [258..262, 98..99]],
      "2E" => [[103..107, 47..48], [108..112, 49..50], [113..117, 51..52], [118..122, 52..54], [123..127, 54..55], [128..132, 56..57], [133..137, 58..59], [138..142, 59..60], [143..147, 61..62], [148..152, 63..64], [153..157, 64..65], [158..162, 66..67], [163..167, 68..69], [168..172, 69..70], [173..177, 71..72], [178..182, 73..74], [183..187, 74..76], [188..192, 76..77], [193..197, 78..79], [198..202, 80..81], [203..207, 81..82], [208..212, 83..84], [213..217, 85..86], [218..222, 86..87], [223..227, 88..89], [228..232, 90..91], [233..237, 91..92], [238..242, 93..94], [243..247, 95..96], [248..252, 96..98], [253..257, 98..99], [258..262, 100..101]],
      "3E" => [[103..107, 49..51], [108..112, 51..52], [113..117, 53..54], [118..122, 55..56], [123..127, 56..57], [128..132, 58..59], [133..137, 60..61], [138..142, 61..62], [143..147, 63..64], [148..152, 65..66], [153..157, 66..67], [158..162, 68..69], [163..167, 70..71], [168..172, 71..73], [173..177, 73..74], [178..182, 75..76], [183..187, 77..78], [188..192, 78..79], [193..197, 80..81], [198..202, 82..83], [203..207, 83..84], [208..212, 85..86], [213..217, 87..88], [218..222, 88..89], [223..227, 90..91], [228..232, 92..93], [233..237, 93..95], [238..242, 95..96], [243..247, 97..98], [248..252, 99..100], [253..257, 100..101], [258..262, 102..103]],
      "4E" => [[103..107, 52..53], [108..112, 53..54], [113..117, 55..56], [118..122, 57..58], [123..127, 58..59], [128..132, 60..61], [133..137, 62..63], [138..142, 63..64], [143..147, 65..66], [148..152, 67..68], [153..157, 68..70], [158..162, 70..71], [163..167, 72..73], [168..172, 74..75], [173..177, 75..76], [178..182, 77..78], [183..187, 79..80], [188..192, 80..81], [193..197, 82..83], [198..202, 84..85], [203..207, 85..86], [208..212, 87..88], [213..217, 89..90], [218..222, 90..92], [223..227, 92..93], [228..232, 94..95], [233..237, 96..97], [238..242, 97..98], [243..247, 99..100], [248..252, 101..102], [253..257, 102..103], [258..262, 104..105]],
      "F" => [[103..107, 54..55], [108..112, 55..56], [113..117, 57..58], [118..122, 59..60], [123..127, 60..61], [128..132, 62..63], [133..137, 64..65], [138..142, 65..67], [143..147, 67..68], [148..152, 69..70], [153..157, 71..72], [158..162, 72..73], [163..167, 74..75], [168..172, 76..77], [173..177, 77..78], [178..182, 79..80], [183..187, 81..82], [188..192, 82..83], [193..197, 84..85], [198..202, 86..87], [203..207, 87..89], [208..212, 89..90], [213..217, 91..92], [218..222, 93..94], [223..227, 94..95], [228..232, 96..97], [233..237, 98..99], [238..242, 99..100], [243..247, 101..102], [248..252, 103..104], [253..257, 104..105], [258..262, 106..107]],
      "G" => [[103..107, 56..57], [108..112, 57..58], [113..117, 59..60], [118..122, 61..62], [123..127, 62..63], [128..132, 64..65], [133..137, 66..67], [138..142, 68..69], [143..147, 69..70], [148..152, 71..72], [153..157, 73..74], [158..162, 74..75], [163..167, 76..77], [168..172, 78..79], [173..177, 79..80], [178..182, 81..82], [183..187, 83..84], [188..192, 84..85], [193..197, 86..87], [198..202, 88..89], [203..207, 90..91], [208..212, 91..92], [213..217, 93..94], [218..222, 95..96], [223..227, 96..97], [228..232, 98..99], [233..237, 100..101], [238..242, 101..102], [243..247, 103..104], [248..252, 105..106], [253..257, 106..107], [258..262, 108..109]]
    } 
  end
end
